<div class="topic-bar">
  {{room.name}}
</div>

<div class="messages-container" ui-scroll-bottom>
  <ul class="messages">
    <li class="messages-loading" ng-show="isLoadingOlder">
      <i class="fa fa-fw fa-refresh fa-spin"></i>
    </li>
    <li ng-repeat="message in messages"
        ng-init="messageUser = user(message.user)"
        class="message message--{{message.event}}"
        ng-class="{'mentioned': mentionsMe(message),
                   'discussion': isDiscussionHead(message),
                   'monologue': isMonologue(message, $index)}">

      <!-- Regular Message -->
      <div ng-if="message.event === 'message'">
        <button type="button"
            class="btn message__discussion-marker"
            ng-click="addComment(message)">
          <i class="fa fa-fw fa-comment"></i>
        </button>
        <div class="message__user">
          <span class="avatar" style="background-image:url({{messageUser.avatar}})"></span>
        </div>
        <div class="message__content">
          <p class="message__content-user">{{messageUser.name}}</p>
          <div ng-bind-html="message.content | nl2br | codeFormat | messageLinks"></div>
        </div>
        <div class="message__time" am-time-ago="message.sent"></div>
      </div>

      <!-- Comment -->
      <div ng-if="message.event === 'comment'">
        <button type="button"
            ng-click="addComment(message)"
            class="btn message__discussion-marker">
          <i class="fa fa-fw fa-comments"></i>
        </button>
        <div class="message__user">
          <span class="avatar" style="background-image:url({{messageUser.avatar}})"></span>
        </div>
        <div class="message__content">
          <p class="message__content-user">{{messageUser.name}}</p>
          <div ng-bind-html="message.content.text | nl2br | codeFormat | messageLinks"></div>
        </div>
        <div class="message__time" am-time-ago="message.sent"></div>
      </div>

      <!-- File -->
      <div ng-if="message.event === 'file'">
        <button type="button"
            class="btn message__discussion-marker"
            ng-click="addComment(message)">
          <i class="fa fa-fw fa-comment"></i>
        </button>
        <div class="message__user">
          <span class="avatar" style="background-image:url({{messageUser.avatar}})"></span>
        </div>
        <div class="message__content">
          <p class="message__content-user">{{messageUser.name}}</p>
          <img alt="{{message.content.file_name}}" ng-src="https://api.flowdock.com{{message.content.path}}">
        </div>
        <div class="message__time" am-time-ago="message.sent"></div>
      </div>

      <!-- JIRA -->
      <div ng-if="message.event === 'jira'" ng-init="jira = message.content">
        <button type="button"
            class="btn message__discussion-marker"
            ng-click="addComment(message)">
          <i class="fa fa-fw fa-comment"></i>
        </button>
        <div class="message__user">
          <span class="avatar"></span>
        </div>
        <div class="message__content">
          <p class="message__content-user">JIRA</p>
          <div ng-include="'views/jira-' + message.content.event_type + '.html'"></div>
        </div>
        <div class="message__time" am-time-ago="message.sent"></div>
      </div>

      <!-- VCS (GitHub) -->
      <div ng-if="message.event === 'vcs'" ng-init="github = message.content">
        <button type="button"
            class="btn message__discussion-marker"
            ng-click="addComment(message)">
          <i class="fa fa-fw fa-comment"></i>
        </button>
        <div class="message__user">
          <div class="avatar">
          </div>
        </div>
        <div class="message__content">
          <p class="message__content-user">GitHub</p>
          <div ng-include="'views/github-' + message.content.event + '.html'"></div>
        </div>
        <div class="message__time" am-time-ago="message.sent"></div>
      </div>
    </li>
  </ul>
</div>
